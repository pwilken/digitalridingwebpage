<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Server Hardening - SSH</title>
    <meta name="description" content="Eine Anleitung um einen Server gegen unerwünschte Gäste zu schützen" />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/csharp.css" />

    <!-- libs -->
    <script src="/assets/js/jquery-3.3.1.min.js"></script>

    <!-- Some specials -->
    <link rel="stylesheet" type="text/css" href="/assets/css/degree-element.css" />
    <script src="/assets/js/degree-element.js"></script>

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="https://digitalriding.de/Server-Hardening-SSH" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Riding the digital wave" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Server Hardening - SSH" />
    <meta property="og:description" content="Eine Anleitung um einen Server gegen unerwünschte Gäste zu schützen" />
    <meta property="og:url" content="https://digitalriding.de/Server-Hardening-SSH" />
    <meta property="og:image" content="/assets/images/shell.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Server Hardening - SSH" />
    <meta name="twitter:description" content="Eine Anleitung um einen Server gegen unerwünschte Gäste zu schützen" />
    <meta name="twitter:url" content="https://digitalriding.de/Server-Hardening-SSH" />
    <meta name="twitter:image:src" content="/assets/images/shell.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Riding the digital wave",
    "name": "Server Hardening - SSH",
    "url": "https://digitalriding.de/Server-Hardening-SSH",
    "image": "/assets/images/shell.jpg",
    "description": "Eine Anleitung um einen Server gegen unerwünschte Gäste zu schützen"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Riding the digital wave" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Start</a></li>
        <li class="nav-about " role="presentation"><a href="/#blogpart">Beiträge</a></li>
        <li class="nav-about " role="presentation"><a href="/sites/projects">Projekte</a></li>
        <li class="nav-about " role="presentation"><a href="/sites\about">Über uns</a></li>
        <li class="nav-about " role="presentation"><a href="/author/pierrewilken">Pierre Wilken</a></li>
        <li class="nav-about " role="presentation"><a href="/author/sgoerzen">Sergej Görzen</a></li>
        <li class="nav-about " role="presentation"><a href="/sites/impressum">Impressum</a></li>
        <li class="nav-about " role="presentation"><a href="/sites/dataprotection">Datenschutzerklärung</a></li>
<!--    <li class="nav-fables " role="presentation"><a href="/tag/fables">Fables</a></li>
        <li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>
        <li class="nav-author " role="presentation"><a href="/author/casper">Casper</a></li>
        <li class="nav-author " role="presentation"><a href="/author/edgar">Edgar</a></li>
        <li class="nav-author " role="presentation"><a href="/author/abraham">Abraham</a></li>
        <li class="nav-author " role="presentation"><a href="/author/martin">Martin</a></li>
        <li class="nav-author " role="presentation"><a href="/author/lewis">Lewis</a></li>
--> </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/shell.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-fiction">

        <header class="post-header">
            <h1 class="post-title">Server Hardening - SSH</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
            
                
            
                
                    <a href='/author/valentinob'>Valentino B.</a>
                
            
            <time class="post-date" datetime="2018-10-12">12 Oct 2018</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/Server'>Server</a>,
                    
                
                    
                       <a href='/tag/SSH'>Ssh</a>,
                    
                
                    
                       <a href='/tag/Hardening'>Hardening</a>
                    
                
                

                
            </section>
        </header>

        <section class="post-content">

            <p>Mietest du einen Server? Wenn ja, hast du ihn so eingerichtet, dass du dir sicher sein kannst, dass nur befugte Personen zugreifen können? Was ist wenn ich dir erzähle, dass ständig jemand versucht über Brute-Force dein SSH Login zu erhalten? Das ganze kann man ganz leicht selber nachprüfen</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tail -f /var/auth.log
</code></pre></div></div>
<p>und einfach mal für eine kurze Zeit beobachten.</p>

<p>Viele Leute scheren sich nicht das initiale Passwort zu ändern, einen neuen Benutzer anzulegen oder SSH angemessen zu konfigurieren. Wundern sollte man sich dann allerdings nicht, wenn man nach einiger Zeit nicht mehr auf den Server zugreifen kann.</p>

<h2 id="was-ist-diese-secure-shell">Was ist diese Secure Shell?</h2>
<p>Es ist ein Netzwerkprotokoll, was auf TCP aufbaut. Es wird benutzt, um eine verschlüsselte Verbindung zu einem Server herzustellen. Die Shell eines entfernten Computers steht einem somit zur Verfügung. Implementiert ist das ganze als klassisches Client - Server Modell.</p>

<h2 id="wie-es-nicht-sein-sollte">Wie es nicht sein sollte</h2>
<p>Man bekommt von seinem Anbieter den Benutzer und das Passwort mitgeteilt, um sich über SSH anzumelden. Der Benutzer ist in der Regel root.</p>

<p>Diese Anmeldeinformationen sollte man allerdings nur bei der ersten Anmeldung nutzen.</p>

<blockquote>
  <p>Das ist genauso wie den Internet Explorer zu benutzen, um einen anderen Browser herunterzuladen.</p>
</blockquote>

<h2 id="der-übermächtige-root">Der übermächtige root</h2>
<p>Es ist keine gute Idee ständig als root unterwegs zu sein. Der root Benutzer hat jegliche Rechte auf dem System und so kann es mal schnell vorkommen, dass man irgendein Befehl oder Befehlskette ausführt die dir deinen Server zerschießen.</p>

<p>Deshalb ist es keine schlechte Idee einen neuen Benutzer anzulegen!</p>

<h2 id="ein-neuer-benutzer">Ein neuer Benutzer</h2>
<p>Da wir also nicht ständig als root unterwegs sein wollen, erstellen wir uns einen neuen Benutzer.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adduser username
</code></pre></div></div>

<p>Eben ein Passwort festlegen und voilà, der neue Benutzer existiert.</p>

<p>Um unseren neuen Benutzer zu ermöglichen Programme zu nutzen, die nur dem root zugeschrieben sind, muss folgendes geschehen</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ usermod -aG sudo username
</code></pre></div></div>

<p>Wir können nun zum neu angelegten Benutzer wechseln</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ su - username
</code></pre></div></div>

<h2 id="schlüsselpaar-generieren">Schlüsselpaar Generieren</h2>

<p>Es werden zwei Schlüssel generiert. Ein öffentlicher und ein privater Schlüssel. Der öffentliche Schlüssel befindet sich nachher auf dem Server. Der private Schlüssel befindet sich auf der Maschine, von wo du dich aus mit dem Server verbindest.</p>
<blockquote>
  <p>An dieser Stelle sollte darauf hingewiesen werden, dass der private Schlüssel nur <strong>dir</strong> bekannt sein sollte.</p>
</blockquote>

<h4 id="linuxunix">Linux/Unix</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh-keygen -b 4096
</code></pre></div></div>

<p>Mit 4096 Bit gehen wir mal auf Nummer sicher.  Im anschließenden Dialog wirst du gefragt, ob du ein Passwort festlegen möchtest. Das ist an dieser Stelle dir selbst überlassen.</p>

<h4 id="windows">Windows</h4>
<p>Wenn das Windows Subsystem for Linux (WSL) aktiviert oder Cygwin installiert ist, dann läuft das Prozedere wie im <a href="#linuxunix">Linux/Unix</a> Abschnitt ab. Falls nicht kann ein graphisches Programm wie PuTTYgen verwendet werden.</p>

<h2 id="keys-übertragen">Keys Übertragen</h2>
<p>Der öffentliche Schlüssel muss zum Server übertragen werden. Das kann auf zwei Arten geschehen, wovon die erste aufgezeigte komfortabler ist.</p>

<p><em>Nr 1.</em></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh-copy-id username@server_ip
</code></pre></div></div>

<p><em>Nr 2.</em>
Den Inhalt des öffentlichen Schlüssels in den Zwischenspeicher packen</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh username@server_ip
$ nano ./ssh/authorized_keys
</code></pre></div></div>
<p>und dann am Besten ans untere Ende in einer neuen Zeile einfügen.</p>

<blockquote>
  <p>Falls das Verzeichnis <code class="highlighter-rouge">.ssh</code> und die Datei <code class="highlighter-rouge">authorized_keys</code> nicht existieren, dann kann man sie per Hand anlegen.</p>
</blockquote>

<p>Wenn bei der erneuten Anmeldung über SSH die Passwortabfrage entfällt, hat das ganze funktioniert.</p>

<h2 id="ssh-konfigurationsdatei">SSH Konfigurationsdatei</h2>
<p>Konfigurationsdateien von Diensten befinden sich bei unixoide System im Verzeichnis <code class="highlighter-rouge">/etc</code>. In unserem Falle passen wir die <code class="highlighter-rouge">/etc/ssh/sshd.config</code> an.</p>

<p>Bevor wir die Datei anpassen, bitte ich darum, dass eine Kopie angelegt wird.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cp /etc/ssh/sshd.config /etc/ssh/sshd.config.bak
</code></pre></div></div>

<h3 id="konfiguration">Konfiguration</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo nano /etc/ssh/sshd.conf 
</code></pre></div></div>

<p>Damit wird die neuere Version des Protokolls benutzen</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Protocol 2
</code></pre></div></div>

<p>Als root sollte man sich nicht mehr über SSH anmelden sollen, denn das ist der naheliegendste Benutzern, den ein Angreifer benutzt, um sich einzuwählen.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PermitRootLogin no
</code></pre></div></div>

<p>Hat das mit den Schlüsseln funktioniert? Dann sollte auf ein Passwort verzichtet werden. Damit fällt einer der größten Angriffsvektoren raus.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PasswordAuthentication no 
</code></pre></div></div>

<p>Nur der Benutzer, den du im Abschnitt <a href="#ein-neuer-benutzer">Ein neuer Benutzer</a> erstellt hast, darf sich über SSH einloggen.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AllowUser username
</code></pre></div></div>

<p>Nachdem alle Anpassungen vorgenommen werden, muss der SSH Dienst neu gestartet werden. So gehts beispielsweise unter Ubuntu</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl reload sshd
</code></pre></div></div>

<h2 id="ssh-port">SSH Port</h2>
<p>Der Port des SSH Servers kann geändert werden. Das geschieht ebenfalls in der Konfigurationsdatei. Man könnte an dieser Stelle denken, dass man dem Angreifer damit ein Strich durch die Rechnung macht. Allerdings muss an dieser Stelle festgehalten werden, dass das faktisch nicht viel bringt.</p>

<p>Es ist trivial standardisierte Dienste  zu ermitteln und das zeigt z.B. ein einfacher Port Scan mit <code class="highlighter-rouge">nmap</code>.</p>

<p>Wenn man sich über einen TCP Client mit einem Server verbindet, worauf ein SSH Dienst läuft, erhält man so eine Antwort.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nc sdf.org 22
$ SSH-2.0-OpenSSH_7.1
</code></pre></div></div>
<blockquote>
  <p>Das ist der Protokoll Anfang, in dem der Server dem Client mitteilt, welche SSH Protokoll Version  benutzt wird, um im folgenden weiter zu kommunizieren.</p>
</blockquote>

<h2 id="zusätzliche-absicherung-mit-fail2ban">Zusätzliche Absicherung mit Fail2Ban</h2>
<p>Mit diesem tollen Programm kann man die IP von unerwünschte Gäste automatisch sperren lassen, die innerhalb eines festgelegten Zeitintervalls eine Anzahl an Anmeldeversuchen überschritten haben.</p>

<h3 id="installation">Installation</h3>
<p>Unter Debian Distributionen</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt install fail2ban
</code></pre></div></div>

<h3 id="konfiguration-1">Konfiguration</h3>
<p>Wieder sollte eine Kopie angelegt werden, bevor wir etwas anpassen.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
</code></pre></div></div>

<p>Die <code class="highlighter-rouge">jail.local</code> überschreibt jegliche Werte, die in der <code class="highlighter-rouge">jail.conf</code> definiert sind. Diese sollte verwendet werden, um Anpassungen vorzunehmen</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo nano /etc/fail2ban/jail.local
</code></pre></div></div>

<p>Es ist existiert schon ein SSH Filter. Dieser muss nur noch aktiviert werden.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[sshd]
enabled=true
</code></pre></div></div>

<p>Nachdem alle Anpassungen vorgenommen werden, muss der fail2ban Dienst neu gestartet werden. So gehts beispielsweise unter Ubuntu</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl restart fail2ban
</code></pre></div></div>
<p>Jetzt zurücklehnen und einfach beobachten</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo tail -f /var/log/fail2ban.log
</code></pre></div></div>

<p>Vielleicht wäre es noch ganz interessant zu wissen, wie man gebannte IPs einsehen kann</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cat /var/log/fail2ban.log | grep Ban
</code></pre></div></div>

<h2 id="ende">Ende</h2>
<p>Ich hoffe du konntest einiges aus diesem Blog Artikel mitnehmen. In Zukunft solltest du besser gewappnet sein :-)</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
            
                
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/valentinob" style="background-image: url(/assets/images/valentinob.jpg)"><span class="hidden">valentinob's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/valentinob">Valentino B.</a></h4>

                        
                            <p> German Software-Engineer</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Deutschland</span>
                            <span class="author-link icon-link"><a href="https://ososystem.de"> ososystem</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Server Hardening - SSH&amp;url=https://digitalriding.deServer-Hardening-SSH"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://digitalriding.deServer-Hardening-SSH"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=https://digitalriding.deServer-Hardening-SSH"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/screenshots/monogame/head01.png)" href="/Einstieg-in-MonoGame">
            <section class="post">
                <h2>Einstieg in MonoGame</h2>
                <p>Mit diesem Artikel beginne ich meine Blogserie zur Spieleprogrammierung. Dabei wird der Fokus auf verschiedene...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/earphone1.jpg)" href="/Earphone-Lifehack-de">
            <section class="post">
                <h2>Lifehack - In-Ear-Kopfhörer Klang günstig verbessern + Abschirmung</h2>
                <p>Der Klang von In-Ear-Kopfhörern kann mit einem einfachen Trick kostengünstig verbessert werden. Benötigt wird dazu...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->

<style type="text/css">
    .post-optional-information {
        height: 75px;
    }
</style>


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">digitalriding</a> &copy; 2019</section>
          <section class="poweredby">Powered by <a href="https://pierrewilken.de/">Pierre Jack Wilken</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-117726176-4', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
